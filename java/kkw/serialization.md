# 직렬화(Serialization)

## 직렬화(Serialization)란?
- 자바 시스템 내부에서 사용되는 객체 또는 데이터를 외부의 자바 시스템에서도 사용할 수 있도록 Byte 형태로 데이터 변환하는 기술
- 시스템적으로 이야기하면 JVM의 메모리에 상주(힙 or 스택)되어 있는 데이터를 Byte형태로 변환하는 기술과 직렬화된 바이트 형태의 데이털르 객체로 변환해서 JVM으로 상주시키는 형태를 같이 이야기함

## 직렬화 조건
- 자바 `기본(Primitive)타입`과 `java.io.Serializable` 인터페이스를 상속받은 `객체`는 직렬화 할 수 있는 기본 조건을 가짐
- `java.io.ObjectOutputStream`를 이용하여 직렬화함

## 역직렬화 조건
- 직렬화 대상이 도니 객체의 클래스가 클래스 패스에 존재해야 하며 import 되어 있어야함
- 자바 직렬화 대상 객체는 동일한 `serialVersionUID`를 가지고 있어야함
  ```
  private static final long serialVersionUID = 1L;
  ```
- `java.io.ObjectInputStream` 를 가지고 역직렬화함

## 직렬화 방법
- 다량의 데이터 직렬화 시 CSV 구조가 많이 쓰이고, 구조적인 데이터는 이전에는 XML 형태를 많이 썻지만 최근에는 JSON 형태로 많이 쓰고 있음
- 문자열 형태
  - CSV
    - 데이터를 표현하는 방법 중 가장 많이 사용되는 방법으로 콤마(,) 기준으로 데이터를 구분
  - JSON
    - 최근에 가장 많이 사용됨
    - 자바스크립트에서 쉽게 사용이 가능
    - 다른 데이터 방식에 비해 오버헤드가 적음




## 자바의 직렬화 사용하는 이유
  - 자바 직렬화 형태의 데이터 교환은 자바 시스템 간의 데이터 교환을 위해서 사용
  - 자바 직렬화는 자바 시스템에 최적화 되어 있어 성능이 우수함
  - 복잡한 데이터 구조의 클래스의 객체도 직렬화 기본 조건만 지키면 큰 작업 없이 바로 직렬화 및 역직렬화가 가능
 - 데이터 타입이 자동으로 맞춰지기에 관련 부분을 신경 안 써주어도 됨

## 직렬화 사용 시 주의해야할 점
- 외부 저장소로 저장되는 데이터는 짧은 만료시간의 데이터를 제외하고 자바 직렬화 사용을 지양한다 -> 호환성 문제가 발생할 수 있음
- 역직렬화시 반드시 예외가 생긴다는 것을 생각하고 개발 하여야함
  - 클래스 구조가 변경될 시 에러가 발생할 수 있음 -> serialVersionUID 값을 관리해주어 방지함
  - 멤버 변수명은 같은데 타입이 변경되는 경우(int -> long) 에러가 발생 -> 타입에 대해 엄격함
- serialVersionUID의 값은 개발 시 직접 관리하도록 함
- 멤버 변수 타입 변경을 지양하도록 함
- 개발자가 직접 컨트롤하기 힘든 객체(프레임워크, 라이브러리에서 제공하는 객체)는 직렬화를 지양함
- **역직렬 화가 되지 않을 때와 같은 예외처리는 기본적으로 해주기**
- 자바 직렬화시에 기본적으로 타입에 대한 정보 등 클래스의 메타 정보도 가지고 있기 때문에 상대적으로 다른 포맷에 비해서 용량이 큼

## 결론
- 장점도 많지만 단점도 많음 -> 신경을 많이 써주어야함
1. 외부 저장소로 저장되는 데이터는 짧은 만료 시간의 데이터를 제외하고 자바 직렬화를 사용을 지양
2. 역직렬화시 반드시 예외가 발생하는 것을 염두하고 개발
3. 자주 변경되는 데이터는 직렬화를 사용하지 않음
4. 긴 만료 시간을 가지는 데이터는 JSON 등 다른 포맷을 사용하여 저장


## 언제 어디서 사용하는가?
 - JVM 메모리에서만 상주되어 있는 객체 데이터를 그대로 영속화(Persistence)가 필요할 때 사용
 - 시스템이 종료 되어도 없어지지 않으며 영속화된 데이터 이기에 네트워크로 전송도 가능함
 - 서블릿 세션
 - 캐시
 - 자바 RMI(Remote Method Invocation)